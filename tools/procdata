#!/bin/sh

[ -f ./procdata ] && cd ..
if [ ! -f tools/procdata ]; then
	echo 'run from the demo root directory' >&2
	exit 1
fi

# process embedded images
#if [ ! -f tools/img2bin/img2bin ]; then
#	make -C tools/img2bin || exit 1
#fi
#alias img2bin=tools/img2bin/img2bin
#
#mkdir -p data
#if [ ! -f data/loading.img -o data/loading.png -nt data/loading.img ]; then
#	echo 'img2bin: loading'
#	img2bin data/loading.png || exit 1
#fi

# process RLE sprites
if [ ! -f tools/rlesprite/rlesprite ]; then
	make -C tools/rlesprite || exit 1
fi
alias rlesprite=tools/rlesprite/rlesprite

if [ ! -f data/dbgfont.spr -o data/src/legible.fnt -nt data/dbgfont.spr ]; then
	echo 'rlesprite: dbgfont'
	rlesprite -o data/dbgfont.spr -s 8x16 -conv565 data/src/legible.fnt
fi

if [ ! -f data/nebula.spr -o data/src/nebula.fnt -nt data/nebula.spr ]; then
	echo 'rlesprite: nebula'
	rlesprite -o data/nebula.spr -s 16x16 -conv565 data/src/nebula.fnt
fi

if [ ! -f data/nebucol.spr -o data/src/nebucol.fnt -nt data/nebucol.spr ]; then
	echo 'rlesprite: nebucol'
	rlesprite -o data/nebucol.spr -s 16x16 -conv565 data/src/nebucol.fnt
fi

if [ ! -f data/nebcobig.spr -o data/src/nebucol.fnt -nt data/nebcobig.spr ]; then
	echo 'rlesprite: nebcobig'
	convert data/src/nebucol.fnt -filter point -resize '200%' data/src/nebcobig.fnt
	rlesprite -o data/nebcobig.spr -s 32x32 -conv565 data/src/nebcobig.fnt
fi

if [ ! -f data/icons.spr -o data/src/icons.png -nt data/icons.spr ]; then
	echo 'rlesprite: icons'
	rlesprite -o data/icons.spr -s 16x16 -conv565 data/src/icons.png
fi
